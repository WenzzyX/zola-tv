{% extends "../../base.html" %}
{% load static %}
{% load i18n %}
{% load settings_tag %}
{% load content_type_tag %}
{% block title %}{{ channel.name }}{% endblock title %}
{% block head_links %}
    <script src="{% static 'main/js/MultiplePlayers.js' %}" type="text/javascript"></script>
{% endblock head_links %}
{% block content %}
    {% get_settings as settings %}
    {% csrf_token %}
    <div class="header-video">
    {% if settings.SHOW_HEADERS %}
            {% include 'main/components/header.html' with popup=0 %}
    {% endif %}
    </div>
    <main class="main-main vido video-body movie-card">
        <div class="main-video">
            <div class="main-video__content" id="mplr">
                <img src="{{ channel.get_poster }}" alt="">
            </div>
        </div>
        <button class="video__back" onclick="history.back()">
            <img src="{% static 'main/img/icons/video-back.svg' %}" alt="">
        </button>
        <div class="video__decription">
            <div class="video__decription_name name_channel">
                {{ channel.name }}
            </div>
            <div class="video__decription_started">
                {#                {{ sport.get_date }}#}
            </div>
            <div class="video__decription_watching">
                <img src="{% static 'main/img/icons/watching.svg' %}" alt="">
                {% trans 'Watching' %}: <span class="randviews"></span>
            </div>
            <div class="video__decription_share vd_share_channel" data-elurl="{% url 'channel-page' pk=channel.id %}"
                 data-elname="{{ channel.name }}" onclick="shareEl(this);">
                <img src="{% static 'main/img/icons/share.svg' %}" alt="">
            </div>
            {% check_added_to_watchlist user=request.user model=channel as added %}
            <div class="video__decription_share vd_share_channel m-add-to-wl-btn {% if added %}add-to-wl-btn_added{% endif %}"
                 data-chid="{{ channel.id }}" onclick="AddToWLBtn(this);" style="margin-top: 50px;">
            </div>
            <div class="video__decription_decor decor_channel"></div>

{#            {% if not settings.ITS_APP %}#}
{#                {% include 'main/banner-templates/proxectxpratingptext.html' %}#}
{#            {% else %}#}
                {% if page.element1 != None %}
                    {% include page.element1.path with component=page.element1 %}
                {% endif %}
{#            {% endif %}#}
        </div>

        {% if page.element2 != None %}
            {% include page.element2.path with component=page.element2 %}
        {% endif %}
        {% if page.element3 != None %}
            {% include page.element3.path with component=page.element3 %}
        {% endif %}
        {% if page.element4 != None %}
            {% include page.element4.path with component=page.element4 %}
        {% endif %}
        {% if page.element5 != None %}
            {% include page.element5.path with component=page.element5 %}
        {% endif %}

        {% if page.element6 != None %}
            {% include page.element6.path with component=page.element6 %}
        {% endif %}
        {% if page.element7 != None %}
            {% include page.element7.path with component=page.element7 %}
        {% endif %}
        {% if page.element8 != None %}
            {% include page.element8.path with component=page.element8 %}
        {% endif %}
        {% if page.element9 != None %}
            {% include page.element9.path with component=page.element9 %}
        {% endif %}
        {% if page.element10 != None %}
            {% include page.element10.path with component=page.element10 %}
        {% endif %}
    </main>
    {% if settings.SHOW_FOOTERS %} {% include 'main/components/footer.html' with page="main" %} {% endif %}
{% endblock content %}

{% block scripts %}
    <script>
        $(document).ready(function () {
            setTimeout(() => {
                try {
                    AndroidFunction.setBottomNavVisibility(false)
                } catch (e) {
                }
            }, 500)

        });

    </script>
    <script>
        var MainPlayer = new Playerjs({
            id: "mainpl",
            file: "{{ channel.get_video }}",
            player: 1,
            poster: "{{ channel.get_poster }}"
        });
        var MidrollAdPl = new Playerjs({
            id: "admid",
            file: "{{ midroll.video.get_video }}",
            player: 2,
            autoplay: false
        });

        function AddToWLBtn(btn) {
            let csrf = document.querySelector('input[name="csrfmiddlewaretoken"]').value
            request = $.ajax({
                url: `/${currLocale}/channel/${btn.getAttribute('data-chid')}/add-to-watchlist`,
                type: "post",
                data: {
                    "csrfmiddlewaretoken": csrf,
                }
            })
            request.done(function (response, textStatus, jqXHR) {
                response = JSON.parse(response)
                if (response.resp == "OK") {
                    btn.classList.toggle('add-to-wl-btn_added')
                } else if (response.resp == "redirect") {
                    window.location.replace(document.location.protocol + "//" + document.location.hostname + response.rev)
                }
            })
        }

        let request = getUrlVars()
        if (request.ref) {
            document.querySelector('.video__back').setAttribute('onclick', 'retToHome();')
            if (getCookie('ref_url') === undefined) {
                setCookie('ref_url', window.location.href)
            }
        }

        function retToHome() {
            window.location = '/'
        }

        function getRandomInt(min, max) {
            min = Math.ceil(min);
            max = Math.floor(max);
            return Math.floor(Math.random() * (max - min) + min);
        }

        $(document).ready(function () {
            let randel = document.querySelector('.randviews')
            let randval = getRandomInt(5012, 13384)
            randel.innerHTML = randval

        })

{#        {% get_settings as settings  %}#}
{#        {% if not settings.ITS_APP %}#}
{#            $(document).ready(function () {#}
{#                let counter = 0#}
{#                let inters = setInterval(() => {#}
{#                    if (MainPlayer.api('time') > {{ settings.time_to_dapp }}) {#}
{#                        window.location = document.location.protocol + "//" + document.location.hostname + "/" + currLocale + '/app-download?msg=1'#}
{#                    }#}
{#                    counter++#}
{#                }, 1000)#}
{##}
{#            })#}
{#        {% endif %}#}
    </script>
{% endblock scripts %}

